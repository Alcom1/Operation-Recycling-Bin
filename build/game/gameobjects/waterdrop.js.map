{
  "version": 3,
  "sources": ["C:\\Users\\Alcom\\Desktop\\Dev\\Git\\Operation Recycling Bin\\src\\game\\gameobjects\\waterdrop.ts"],
  "sourcesContent": ["import { GameObjectParams } from \"engine/gameobjects/gameobject\";\r\nimport { Collider } from \"engine/modules/collision\";\r\nimport { BOUNDARY, GMULTY } from \"engine/utilities/math\";\r\nimport Vect from \"engine/utilities/vect\";\r\nimport Animat, { AnimationParams } from \"./animation\";\r\nimport BrickHandler from \"./brickhandler\";\r\nimport Sprite from \"./sprite\";\r\n\r\n//Water drop params\r\nconst characterBotOverride = Object.freeze({\r\n    image: \"part_water\",\r\n    zIndex: 0,\r\n});\r\n\r\n/** Single image gameobject */\r\nexport default class WaterDrop extends Sprite {\r\n\r\n    private speed : number = 500;\r\n    private brickHandler! : BrickHandler;\r\n    private animLand: Animat;\r\n    private animSlip: Animat;\r\n    private slipDuration : number = 0.4;\r\n    private slipTimer: number = 0;\r\n\r\n    constructor(params: GameObjectParams) {\r\n        super(Object.assign(params, characterBotOverride));\r\n\r\n        this.animLand = this.parent.pushGO(new Animat({\r\n            ...params,\r\n            zModifier : 100,\r\n            images : [{ name : \"part_water_land\" }],\r\n            speed : 2.5,\r\n            frameCount : 6,\r\n            isVert : true,\r\n            isActive : false,\r\n            isLoop : false\r\n        } as AnimationParams)) as Animat;\r\n\r\n        this.animSlip = this.parent.pushGO(new Animat({\r\n            ...params,\r\n            zModifier : 100,\r\n            images : [{ name : \"part_water_slip\" }],\r\n            speed : 1 / this.slipDuration,\r\n            frameCount : 6,\r\n            isVert : true,\r\n            isActive : false,\r\n            isLoop : false\r\n        } as AnimationParams)) as Animat;\r\n\r\n        this.isActive = false;  //Start deactivated\r\n    }\r\n\r\n    //Get brick handler for brick collisions\r\n    public init() {\r\n\r\n        //Get brick handler to to check brick-wind collisions\r\n        this.brickHandler = this.engine.tag.get(\r\n            \"BrickHandler\", \r\n            \"LevelInterface\")[0] as BrickHandler;\r\n    }\r\n\r\n    //Move waterdrop down.\r\n    public update(dt : number) {\r\n\r\n        if(this.slipTimer < this.slipDuration) {\r\n            this.slipTimer += dt;\r\n            return;\r\n        }\r\n        else {\r\n            this.animSlip.isActive = false;\r\n        }\r\n\r\n        this.spos.y += dt * this.speed;\r\n\r\n        if(this.spos.y > GMULTY) {\r\n            this.spos.y -= GMULTY;\r\n            this.gpos.y += 1;\r\n\r\n            //Collide with lower boundary or bricks\r\n            if (this.gpos.y > BOUNDARY.maxy || \r\n                this.brickHandler.checkCollisionRange(\r\n                this.gpos,  //Position\r\n                0,          //START\r\n                2,          //FINAL\r\n                1,          //HEIGHT\r\n                1)) {       //Direction\r\n\r\n                this.doLandAnimation();\r\n            } \r\n        }\r\n    }\r\n\r\n    //Draw only after slip animation ends\r\n    public draw(ctx : CanvasRenderingContext2D) {\r\n        if(this.slipTimer >= this.slipDuration) {\r\n            super.draw(ctx);\r\n        }\r\n    }\r\n\r\n    //Reset and spawn this waterdrop.\r\n    public reset(gpos : Vect) {\r\n\r\n        this.isActive = true;\r\n        this.gpos = gpos.get();\r\n        this.spos = { x : 0, y : 0 } as Vect;\r\n        this.slipTimer = 0;\r\n        this.animSlip.isActive = true;\r\n        this.animSlip.reset(this.gpos);\r\n    }\r\n\r\n    //Remove this waterdrop upon collision\r\n    public resolveCollision() {\r\n        this.doLandAnimation();\r\n    }\r\n\r\n    //Perform a waterdrop landing animation\r\n    private doLandAnimation() {\r\n\r\n        this.isActive = false;\r\n        this.animLand.isActive = true;\r\n        this.animLand.reset(this.gpos);\r\n    }\r\n\r\n    //Get hazard and passive colliders of this brick.\r\n    public getColliders() : Collider[] {\r\n\r\n        //Return hazard hitbox\r\n        return [{\r\n            mask : 0b100100,   //Hazard & other\r\n            min : this.gpos,\r\n            max : this.gpos.getAdd({ x : 2, y :  1}) \r\n        }];\r\n    }\r\n}"],
  "mappings": "AAEA;AAEA;AAEA;AAGA,MAAM,uBAAuB,OAAO,OAAO;AAAA,EACvC,OAAO;AAAA,EACP,QAAQ;AAAA;AAXZ,uCAeuC;AAAA,EASnC;AACI,UAAM,OAAO,OAAO,QAAQ;AARxB,iBAAiB;AAIjB,wBAAwB;AACxB,qBAAoB;AAKxB,SAAK,WAAW,KAAK,OAAO,OAAO,IAAI,OAAO;AAAA,SACvC;AAAA,MACH,WAAY;AAAA,MACZ,QAAS,CAAC,CAAE,MAAO;AAAA,MACnB,OAAQ;AAAA,MACR,YAAa;AAAA,MACb,QAAS;AAAA,MACT,UAAW;AAAA,MACX,QAAS;AAAA;AAGb,SAAK,WAAW,KAAK,OAAO,OAAO,IAAI,OAAO;AAAA,SACvC;AAAA,MACH,WAAY;AAAA,MACZ,QAAS,CAAC,CAAE,MAAO;AAAA,MACnB,OAAQ,IAAI,KAAK;AAAA,MACjB,YAAa;AAAA,MACb,QAAS;AAAA,MACT,UAAW;AAAA,MACX,QAAS;AAAA;AAGb,SAAK,WAAW;AAAA;AAAA,EAIb;AAGH,SAAK,eAAe,KAAK,OAAO,IAAI,IAChC,gBACA,kBAAkB;AAAA;AAAA,EAInB;AAEH,QAAG,KAAK,YAAY,KAAK;AACrB,WAAK,aAAa;AAClB;AAAA;AAGA,WAAK,SAAS,WAAW;AAAA;AAG7B,SAAK,KAAK,KAAK,KAAK,KAAK;AAEzB,QAAG,KAAK,KAAK,IAAI;AACb,WAAK,KAAK,KAAK;AACf,WAAK,KAAK,KAAK;AAGf,UAAI,KAAK,KAAK,IAAI,SAAS,QACvB,KAAK,aAAa,oBAClB,KAAK,MACL,GACA,GACA,GACA;AAEA,aAAK;AAAA;AAAA;AAAA;AAAA,EAMV;AACH,QAAG,KAAK,aAAa,KAAK;AACtB,YAAM,KAAK;AAAA;AAAA;AAAA,EAKZ;AAEH,SAAK,WAAW;AAChB,SAAK,OAAO,KAAK;AACjB,SAAK,OAAO,CAAE,GAAI,GAAG,GAAI;AACzB,SAAK,YAAY;AACjB,SAAK,SAAS,WAAW;AACzB,SAAK,SAAS,MAAM,KAAK;AAAA;AAAA,EAItB;AACH,SAAK;AAAA;AAAA,EAID;AAEJ,SAAK,WAAW;AAChB,SAAK,SAAS,WAAW;AACzB,SAAK,SAAS,MAAM,KAAK;AAAA;AAAA,EAItB;AAGH,WAAO,CAAC;AAAA,MACJ,MAAO;AAAA,MACP,KAAM,KAAK;AAAA,MACX,KAAM,KAAK,KAAK,OAAO,CAAE,GAAI,GAAG,GAAK;AAAA;AAAA;AAAA;",
  "names": []
}
