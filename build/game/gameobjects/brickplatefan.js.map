{
  "version": 3,
  "sources": ["C:\\Users\\Alcom\\Desktop\\Dev\\Git\\Operation Recycling Bin\\src\\game\\gameobjects\\brickplatefan.ts"],
  "sourcesContent": ["import { Collider } from \"engine/modules/collision\";\r\nimport { Z_DEPTH } from \"engine/utilities/math\";\r\nimport Animat, { AnimationParams } from \"./animation\";\r\nimport BrickHandler from \"./brickhandler\";\r\nimport BrickPlate, { BrickPlateParams } from \"./brickplate\";\r\nimport Character from \"./character\";\r\n\r\nconst brickPlateFanOverride = Object.freeze({\r\n    images : [\"brick_plate\", \"brick_plate_fan\"],\r\n    width : 4\r\n});\r\n\r\nexport default class BrickPlateFan extends BrickPlate {\r\n\r\n    private brickHandler!: BrickHandler;\r\n    private animations: Animat[] = [];\r\n    private beams: number[] = [];\r\n    private characters: Character[] = [];\r\n\r\n    constructor(params: BrickPlateParams) {\r\n        super(Object.assign(params, brickPlateFanOverride));\r\n\r\n        //Going up to the ceiling\r\n        for(let j = this.gpos.y - 1; j > 0; j--) {\r\n            //Generate a wind animation for each position\r\n            [0,1].forEach(i => {\r\n                this.animations.push(this.parent.pushGO(new Animat({\r\n                    ...params,\r\n                    position : {x : this.gpos.x + i + 1, y : j},\r\n                    subPosition : { x : Z_DEPTH / 2 - 2, y : -Z_DEPTH / 2 + 2 }, \r\n                    zModifier : 1,                                      \r\n                    images : [{ name : \"part_wind\", offsetX : 0 }],\r\n                    speed : 2,\r\n                    frameCount : 6,\r\n                    isLoop : true                                        \r\n                } as AnimationParams)) as Animat);\r\n            })\r\n        }\r\n    }\r\n\r\n    public init() {\r\n\r\n        //Get brick handler to to check brick-wind collisions\r\n        this.brickHandler = this.engine.tag.get(\r\n            \"BrickHandler\", \r\n            \"LevelInterface\")[0] as BrickHandler;\r\n\r\n        //Get characters to stop wind\r\n        this.characters = this.engine.tag.get(\r\n            \"Character\", \r\n            \"Level\") as Character[];\r\n\r\n        //Set the beams for drawing the animations\r\n        this.setBeams();\r\n    }\r\n\r\n    //Update wind beams\r\n    public update() {\r\n\r\n        //Set animations\r\n        this.beams.forEach((y, x) => {\r\n            this.animations.forEach(a => {\r\n                if(a.gpos.x == this.gpos.x + x + 1) {\r\n                    a.isVisible = this.isOn && a.gpos.y >= y\r\n                }\r\n            });\r\n        });\r\n    }\r\n\r\n    //Set wind beams\r\n    private setBeams() {\r\n\r\n        //2 beams per fan\r\n        this.beams = [1, 2] \r\n        //Collide wind beams with bricks\r\n        .map(i => {\r\n            return this.brickHandler.checkCollisionRange(            \r\n                { x : this.gpos.x + i, y : -1 },        //Position\r\n                0,                                      //START\r\n                this.gpos.y - 1,                        //FINAL\r\n                this.gpos.y - 1).toString(2).length;    //HEIGHT\r\n        })\r\n        //Collide wind beams with characters\r\n        .map((b, i) => {\r\n\r\n            let ret = b;\r\n\r\n            //Collide with each character\r\n            this.characters.forEach(c => {\r\n                if (c.gpos.y <= this.gpos.y &&\r\n                    [1,2].some(x => x == c.gpos.x - this.gpos.x - i)) {\r\n                    ret = Math.max(ret, c.gpos.y - c.height + 3);   //Stop beam underneath characters\r\n                }\r\n            });\r\n\r\n            return ret;\r\n        })\r\n    }\r\n\r\n    //Get hazard and passive colliders of this brick.\r\n    public getColliders() : Collider[] {\r\n        \r\n        //Set the beams for the collider (also for drawing the animations)\r\n        this.setBeams();\r\n        \r\n        //Combine with passive collider from base class\r\n        return super.getColliders().concat(this.isOn ? \r\n            this.beams.map((b, i) => {\r\n                return {\r\n                    mask : 0b1000,\r\n                    min : { x : this.gpos.x + i + 1, y : b },\r\n                    max : this.gpos.getAdd({ x : i + 2, y :  0})\r\n                }\r\n            }) : \r\n            []);\r\n    }\r\n}"],
  "mappings": "AACA;AACA;AAEA;AAGA,MAAM,wBAAwB,OAAO,OAAO;AAAA,EACxC,QAAS,CAAC,eAAe;AAAA,EACzB,OAAQ;AAAA;AATZ,2CAY2C;AAAA,EAOvC;AACI,UAAM,OAAO,OAAO,QAAQ;AALxB,sBAAuB;AACvB,iBAAkB;AAClB,sBAA0B;AAM9B,iBAAY,KAAK,KAAK,IAAI,GAAG,IAAI,GAAG;AAEhC,OAAC,GAAE,GAAG,QAAQ;AACV,aAAK,WAAW,KAAK,KAAK,OAAO,OAAO,IAAI,OAAO;AAAA,aAC5C;AAAA,UACH,UAAW,CAAC,GAAI,KAAK,KAAK,IAAI,IAAI,GAAG,GAAI;AAAA,UACzC,aAAc,CAAE,GAAI,UAAU,IAAI,GAAG,GAAI,CAAC,UAAU,IAAI;AAAA,UACxD,WAAY;AAAA,UACZ,QAAS,CAAC,CAAE,MAAO,aAAa,SAAU;AAAA,UAC1C,OAAQ;AAAA,UACR,YAAa;AAAA,UACb,QAAS;AAAA;AAAA;AAAA;AAAA;AAAA,EAMlB;AAGH,SAAK,eAAe,KAAK,OAAO,IAAI,IAChC,gBACA,kBAAkB;AAGtB,SAAK,aAAa,KAAK,OAAO,IAAI,IAC9B,aACA;AAGJ,SAAK;AAAA;AAAA,EAIF;AAGH,SAAK,MAAM,QAAQ;AACf,WAAK,WAAW,QAAQ;AACpB,YAAG,EAAE,KAAK,KAAK,KAAK,KAAK,IAAI,IAAI;AAC7B,YAAE,YAAY,KAAK,QAAQ,EAAE,KAAK,KAAK;AAAA;AAAA;AAAA;AAAA;AAAA,EAO/C;AAGJ,SAAK,QAAQ,CAAC,GAAG,GAEhB,IAAI;AACD,aAAO,KAAK,aAAa,oBACrB,CAAE,GAAI,KAAK,KAAK,IAAI,GAAG,GAAI,KAC3B,GACA,KAAK,KAAK,IAAI,GACd,KAAK,KAAK,IAAI,GAAG,SAAS,GAAG;AAAA,OAGpC,IAAI;AAED,gBAAU;AAGV,WAAK,WAAW,QAAQ;AACpB,YAAI,EAAE,KAAK,KAAK,KAAK,KAAK,KACtB,CAAC,GAAE,GAAG,KAAK,OAAK,KAAK,EAAE,KAAK,IAAI,KAAK,KAAK,IAAI;AAC9C,gBAAM,KAAK,IAAI,KAAK,EAAE,KAAK,IAAI,EAAE,SAAS;AAAA;AAAA;AAIlD,aAAO;AAAA;AAAA;AAAA,EAKR;AAGH,SAAK;AAGL,WAAO,MAAM,eAAe,OAAO,KAAK,OACpC,KAAK,MAAM,IAAI;AACX,aAAO;AAAA,QACH,MAAO;AAAA,QACP,KAAM,CAAE,GAAI,KAAK,KAAK,IAAI,IAAI,GAAG,GAAI;AAAA,QACrC,KAAM,KAAK,KAAK,OAAO,CAAE,GAAI,IAAI,GAAG,GAAK;AAAA;AAAA,SAGjD;AAAA;AAAA;",
  "names": []
}
